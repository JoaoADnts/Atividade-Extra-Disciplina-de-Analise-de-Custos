<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio de An√°lise de Rentabilidade</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo para blocos de c√≥digo */
        pre {
            background-color: #f3f4f6; /* cinza claro */
            border-left: 4px solid #4f46e5; /* indigo */
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.875rem; /* 14px */
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        /* Estilo para tabelas */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }
        th, td {
            border: 1px solid #e5e7eb; /* cinza */
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #f9fafb; /* cinza bem claro */
        }
        /* Estilo para outputs do console */
        .console-output {
            background-color: #1f2937; /* cinza escuro */
            color: #d1d5db; /* cinza claro */
            font-family: 'Courier New', Courier, monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.875rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        .console-output strong {
            color: #a7f3d0; /* verde claro */
        }
    </style>
</head>
<body class="bg-gray-100 font-sans leading-relaxed">

    <div class="container mx-auto max-w-4xl p-6 lg:p-12 bg-white shadow-lg rounded-lg my-12">

        <!-- Cabe√ßalho -->
        <header class="border-b-2 border-gray-200 pb-6 mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Relat√≥rio de An√°lise de Custos e Rentabilidade</h1>
            <p class="text-lg text-gray-600 mt-2">Uma an√°lise de regress√£o m√∫ltipla para identificar fatores de lucro.</p>
            <p class="text-sm text-gray-500 mt-1">Alunos: Jo√£o Lucas, Pedro Lucas e Elton Cesino | Data: 17/11/2025</p>
        </header>

        <!-- Introdu√ß√£o -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Objetivo da An√°lise</h2>
            <p class="text-gray-700">
                O objetivo deste relat√≥rio √© analisar os dados de vendas da rede de supermercados para identificar quais fatores
                influenciam de forma estatisticamente significativa o <strong>lucro por loja</strong>. Utilizamos um modelo de
                Regress√£o Linear M√∫ltipla (MLR) para isolar o impacto de vari√°veis como custo de aquisi√ß√£o,
                tipo de loja, tipo de m√≠dia e faixa de renda.
            </p>
            <p class="text-gray-700 mt-3">
                O pipeline de an√°lise, executado em Python, segue 6 passos principais: Carregamento, Amostragem, Limpeza de Outliers,
                Engenharia de Features, Modelagem e Conclus√£o Gerencial.
            </p>
        </section>

        <!-- PASSO 0: Configura√ß√£o Inicial -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 0: Configura√ß√£o e Bibliotecas</h2>
            <p class="text-gray-700">
                Iniciamos importando as bibliotecas necess√°rias para a an√°lise: <strong>Pandas</strong> para manipula√ß√£o de dados,
                <strong>Statsmodels</strong> para o modelo estat√≠stico, <strong>Scikit-learn</strong> para divis√£o dos dados e <strong>re</strong> para limpeza de texto.
            </p>
            <pre><code>import pandas as pd
import statsmodels.api as sm
from sklearn.model_selection import train_test_split
import re

# Configura√ß√£o para exibir todas as colunas e formatar floats
pd.set_option('display.max_columns', None)
pd.set_option('display.float_format', lambda x: '%.2f' % x)</code></pre>
        </section>

        <!-- PASSO 1: Carregamento e Amostragem -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 1: Carregamento e Amostragem</h2>
            <p class="text-gray-700">
                Carregamos o dataset completo (60.428 linhas). Para agilizar a an√°lise e garantir a reprodutibilidade,
                selecionamos uma amostra aleat√≥ria de 20.000 registros (com `random_state=42`).
            </p>
            <pre><code># --- PASSO 1: CARREGAMENTO E INSPE√á√ÉO ---
df = pd.read_csv("df_atv_extra_ii_unid_completo.csv", index_col=0)

# --- NOVO PASSO: AMOSTRAGEM ALEAT√ìRIA (PASSO 1.2) ---
SAMPLE_SIZE = 20000
linhas_originais_total = len(df)

if linhas_originais_total > SAMPLE_SIZE:
    df = df.sample(n=SAMPLE_SIZE, random_state=42)</code></pre>
            
            <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-2">Sa√≠da (Console):</h3>
            <div class="console-output">
                <p>Iniciando a An√°lise de Custos e Rentabilidade...</p>
                <p><strong>--- PASSO 1: Carregamento e Inspe√ß√£o dos Dados ---</strong></p>
                <p>Arquivo 'df_atv_extra_ii_unid_completo.csv' carregado com sucesso.</p>
                <p><strong>--- PASSO 1.2: Amostragem Aleat√≥ria ---</strong></p>
                <p>Reduzindo o DataFrame completo para uma amostra aleat√≥ria de 20000 linhas.</p>
                <p>Amostra de 20000 linhas criada com sucesso.</p>
            </div>
        </section>

        <!-- PASSO 1.5: Limpeza de Outliers -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 1.5: Tratamento de Outliers (Custos)</h2>
            <p class="text-gray-700">
                Uma an√°lise inicial revelou outliers extremos na coluna `custo_loja_milhoes` (ex: 999 milh√µes),
                provavelmente erros de digita√ß√£o. Esses valores distorcem a an√°lise de lucro.
            </p>
            <p class="text-gray-700 mt-3">
                Utilizamos o m√©todo estat√≠stico <strong>IQR (Intervalo Interquartil)</strong> para identificar e remover
                esses valores extremos da nossa amostra.
            </p>
            <pre><code># --- NOVO PASSO: Tratamento de Outliers ---
Q1 = df['custo_loja_milhoes'].quantile(0.25)
Q3 = df['custo_loja_milhoes'].quantile(0.75)
IQR = Q3 - Q1
limite_superior = Q3 + (1.5 * IQR)

len_original = len(df) # Tamanho da amostra (20000)
df = df[df['custo_loja_milhoes'] <= limite_superior].copy()
linhas_novas = len(df)
registros_removidos = len_original - linhas_novas</code></pre>

            <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-2">Sa√≠da (Console):</h3>
            <div class="console-output">
                <p><strong>--- PASSO 1.5: Tratamento de Outliers (Custos) na Amostra ---</strong></p>
                <p>Estat√≠sticas de Custo (IQR) da Amostra: Q1=1900800.00, Q3=4207625.00, IQR=2306825.00</p>
                <p>Limite superior para custos (Q3 + 1.5*IQR): 7667862.50</p>
                <p><br><strong>Justificativa:</strong> A remo√ß√£o de outliers √© crucial. Valores extremos (ex: custos de 999 milh√µes)</p>
                <p>s√£o provavelemente erros de digita√ß√£o e distorcem a m√©dia e o modelo de regress√£o,</p>
                <p>levando a conclus√µes gerenciais incorretas. Removemos custos acima do limite estat√≠stico para analisar o comportamento 'normal' das lojas.</p>
                <p><br>Linhas da amostra antes da limpeza: 20000</p>
                <p>Linhas removidas (outliers de custo): 1436</p>
                <p>Linhas restantes para an√°lise: 18564</p>
            </div>
        </section>

        <!-- PASSO 2 e 3: Features e EDA -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 2 e 3: Engenharia de Features e An√°lise Explorat√≥ria (EDA)</h2>
            <p class="text-gray-700">
                Com os dados limpos (18.564 linhas), criamos as colunas `lucro_milhoes` e `margem_lucro_percentual`.
                Em seguida, executamos uma an√°lise descritiva b√°sica para entender o novo cen√°rio.
            </p>
            <pre><code># --- PASSO 2: Engenharia de Features ---
df['lucro_milhoes'] = df['vendas_loja_milhoes'] - df['custo_loja_milhoes']
df['margem_lucro_percentual'] = (df['lucro_milhoes'] / df['vendas_loja_milhoes']) * 100
df.replace([float('inf'), float('-inf')], 0, inplace=True)
df.fillna(0, inplace=True)

# --- PASSO 3: An√°lise Explorat√≥ria (EDA) ---
print(df[['vendas_loja_milhoes', 'custo_loja_milhoes', 'lucro_milhoes', 'custo_aquisicao_cliente']].describe())</code></pre>
            
            <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-2">Sa√≠da (EDA): Estat√≠sticas Descritivas</h3>
            <p class="text-gray-600 mb-3">Ap√≥s a limpeza, o lucro m√©dio (`mean`) √© <strong>positivo (3.85M)</strong>, o que √© um cen√°rio muito mais realista.</p>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>M√©trica</th>
                            <th>vendas_loja_milhoes</th>
                            <th>custo_loja_milhoes</th>
                            <th>lucro_milhoes</th>
                            <th>custo_aquisicao_cliente</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>count</td>
                            <td>18564.00</td>
                            <td>18564.00</td>
                            <td>18564.00</td>
                            <td>18564.00</td>
                        </tr>
                        <tr>
                            <td>mean</td>
                            <td>6843060.22</td>
                            <td>2986963.16</td>
                            <td>3856097.06</td>
                            <td>99.22</td>
                        </tr>
                        <tr>
                            <td>std</td>
                            <td>3308654.92</td>
                            <td>1476048.45</td>
                            <td>2658751.32</td>
                            <td>29.98</td>
                        </tr>
                        <tr>
                            <td>min</td>
                            <td>510000.00</td>
                            <td>330000.00</td>
                            <td>-6084000.00</td>
                            <td>50.79</td>
                        </tr>
                        <tr>
                            <td>25%</td>
                            <td>4400000.00</td>
                            <td>1839500.00</td>
                            <td>2587725.00</td>
                            <td>69.65</td>
                        </tr>
                        <tr>
                            <td>50%</td>
                            <td>6450000.00</td>
                            <td>2672400.00</td>
                            <td>3782000.00</td>
                            <td>97.34</td>
                        </tr>
                        <tr>
                            <td>75%</td>
                            <td>8840000.00</td>
                            <td>3814800.00</td>
                            <td>5352400.00</td>
                            <td>126.62</td>
                        </tr>
                        <tr>
                            <td>max</td>
                            <td>19750000.00</td>
                            <td>7665000.00</td>
                            <td>13090000.00</td>
                            <td>149.75</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- PASSO 4 e 5: Modelo e Resultados -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 4 e 5: Modelo de Regress√£o (MLR) e Resultados</h2>
            <p class="text-gray-700">
                O cora√ß√£o da an√°lise. Definimos `lucro_milhoes` como nossa vari√°vel dependente ($Y$).
                As vari√°veis independentes ($X$) incluem fatores num√©ricos e categ√≥ricos. As categ√≥ricas (ex: `tipo_loja`)
                s√£o convertidas em vari√°veis "dummy" (One-Hot Encoding).
            </p>
            <p class="text-gray-700 mt-3">
                Dividimos os dados em treino (80%) e teste (20%) e treinamos o modelo `sm.OLS` (Ordinary Least Squares).
            </p>
            <pre><code># --- PASSO 4: Prepara√ß√£o do Modelo ---
variavel_dependente = 'lucro_milhoes'
features_numericas = ['custo_aquisicao_cliente', 'preco_sugerido']
features_categoricas = ['tipo_loja', 'pais_venda', 'tipo_midia', 'faixa_renda_anual']

df_model = df[features_numericas + features_categoricas + [variavel_dependente]].copy()
df_model.dropna(inplace=True)

df_dummies = pd.get_dummies(df_model, columns=features_categoricas, drop_first=True)
df_dummies.columns = [re.sub(r'[^A-Za-z0-9_]+', '', col) for col in df_dummies.columns]

Y = df_dummies[variavel_dependente].astype(float)
X_cols = [col for col in df_dummies.columns if col != variavel_dependente]
X = df_dummies[X_cols].astype(float)

X = sm.add_constant(X, prepend=False)
X_train, X_test, Y_train, Y_test = train_test_split(X, Y, test_size=0.2, random_state=42)

# --- Treinamento ---
model = sm.OLS(Y_train, X_train).fit()

# --- PASSO 5: Interpreta√ß√£o ---
print(model.summary())</code></pre>
            
            <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-2">Sa√≠da (Passo 5): Sum√°rio do Modelo OLS</h3>
            <p class="text-gray-600 mb-3">
                Abaixo est√° o sum√°rio estat√≠stico completo. Focamos em duas m√©tricas principais:
                <br>1. <strong>R¬≤ Ajustado:</strong> Qu√£o bem o modelo explica o lucro.
                <br>2. <strong>P>|t| (p-value):</strong> A signific√¢ncia estat√≠stica de cada fator (idealmente < 0.05).
            </p>
            <!-- Dados atualizados da execu√ß√£o real do script -->
            <div class="console-output text-sm">
<pre class="!bg-transparent !text-current !p-0">
                                OLS Regression Results
==============================================================================
Dep. Variable:          lucro_milhoes   R-squared:                       0.617
Model:                            OLS   Adj. R-squared:                  0.616
Method:                 Least Squares   F-statistic:                     883.8
Date:                Mon, 17 Nov 2025   Prob (F-statistic):               0.00
Time:                        22:33:09   Log-Likelihood:            -2.3361e+05
No. Observations:               14851   AIC:                         4.673e+05
Df Residuals:                   14823   BIC:                         4.675e+05
Df Model:                          27
Covariance Type:            nonrobust
====================================================================================================
                                 coef    std err          t      P>|t|      [0.025      0.975]
----------------------------------------------------------------------------------------------------
custo_aquisicao_cliente       -349.5565    475.592     -0.735      0.462   -1281.775     582.662
preco_sugerido               2.272e+06   1.51e+04    150.080      0.000    2.24e+06     2.3e+06
tipo_loja_gourmet_supermarket -1.458e+04   5.05e+04     -0.289      0.773   -1.14e+05    8.44e+04
tipo_loja_midsize_grocery     8.2e+04    6.85e+04      1.198      0.231   -5.22e+04    2.16e+05
tipo_loja_small_grocery     -2.756e+06   8.49e+04    -32.446      0.000   -2.92e+06   -2.59e+06
tipo_loja_supermarket        4.599e+04   3.39e+04      1.356      0.175   -2.05e+04    1.12e+05
pais_venda_mexico            1724.6989   5.95e+04      0.029      0.977   -1.15e+05    1.18e+05
pais_venda_usa             -1.782e+04   5.98e+04     -0.298      0.766   -1.35e+05    9.95e+04
... (outras vari√°veis de m√≠dia e renda omitidas para brevidade, todas com P>|t| > 0.05) ...
const                       -1.102e+06   1.01e+05    -10.967      0.000    -1.3e+06   -9.05e+05
==============================================================================
Omnibus:                     2790.900   Durbin-Watson:                   2.004
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             6290.546
Skew:                          -1.080   Prob(JB):                         0.00
Kurtosis:                       5.345   Cond. No.                     1.64e+03
==============================================================================
</pre>
            </div>
            <p class="text-sm text-gray-600 mt-4">
                <strong>Nota sobre o R¬≤:</strong> O R¬≤ Ajustado (61.6%) est√° muito melhor ap√≥s a limpeza. Isso indica que
                nosso modelo explica 61.6% da varia√ß√£o no lucro, um resultado moderado-forte.
                <br>
                <strong>Nota sobre Multicolinearidade:</strong> O "Cond. No." (Condition Number) ainda √© alto (1.64e+03),
                sugerindo que algumas vari√°veis (como os tipos de m√≠dia) est√£o correlacionadas.
            </p>
        </section>


        <!-- PASSO 6: Conclus√µes Gerenciais -->
        <section class="mb-10">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Passo 6: Conclus√£o Gerencial e A√ß√µes Recomendadas</h2>
            <p class="text-gray-700">
                Esta √© a parte mais importante. Traduzimos os resultados estat√≠sticos (p-values < 0.05)
                em recomenda√ß√µes acion√°veis para a gest√£o, com base nos dados reais gerados.
            </p>
            <pre><code># (O c√≥digo do PASSO 6 filtra as vari√°veis 'significant_vars' 
# e 'insignificant_vars' e imprime as conclus√µes abaixo)</code></pre>

            <div class="border-l-4 border-indigo-600 bg-indigo-50 p-6 rounded-lg mt-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Recomenda√ß√µes Estrat√©gicas</h3>
                
                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-800">1. Fator Chave de Lucro: Pre√ßo Sugerido (Significativo)</p>
                    <p class="ml-4 text-gray-700">
                        O `preco_sugerido` √©, de longe, o fator mais impactante e estatisticamente significativo
                        (P>|t| = 0.000). Cada $1 de aumento no pre√ßo sugerido est√° associado a um
                        aumento de $2,27 milh√µes no lucro. Isso sugere que a estrat√©gia de precifica√ß√£o
                        √© um pilar central da rentabilidade.
                    </p>
                </div>

                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-800">2. Analisar Lojas de Baixa Performance (Significativo):</p>
                    <p class="ml-4 text-gray-700">
                        O formato 'tipo_loja_small_grocery' √© o √∫nico fator de loja com impacto
                        significativo, sendo ele <strong>extremamente negativo</strong>
                        (redu√ß√£o de 2.756.002,64 milh√µes vs. refer√™ncia; P>|t| = 0.000).
                        Recomenda-se an√°lise de causa raiz urgente para este formato.
                    </p>
                </div>

                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-800">3. Revisar Custo de Aquisi√ß√£o (N√£o Significativo):</p>
                    <p class="ml-4 text-gray-700">
                        O 'custo_aquisicao_cliente' <strong>N√ÉO</strong> mostrou impacto estat√≠stico significativo no lucro (P>|t| = 0.462).
                        Isso sugere que o investimento atual pode n√£o estar otimizado
                        ou seu impacto √© sobrepujado por outros fatores. Requer an√°lise de ROI.
                    </p>
                </div>
                
                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-800">4. Reavaliar Or√ßamento de M√≠dia (N√£o Significativo):</p>
                    <p class="ml-4 text-gray-700">
                        <strong>Nenhum</strong> dos 12 canais de m√≠dia apresentou impacto estatisticamente
                        significativo no lucro (todos com P>|t| > 0.05). Recomenda-se uma auditoria de ROI
                        completa nestes canais e considerar realocar o or√ßamento para √°reas com impacto
                        comprovado (como estrat√©gia de precifica√ß√£o ou reforma das 'small_grocery').
                    </p>
                </div>
                
                <div class="mb-4">
                    <p class="font-semibold text-lg text-gray-800">5. Renda e Pa√≠s (N√£o Significativo):</p>
                    <p class="ml-4 text-gray-700">
                        Nenhuma faixa de renda ou pa√≠s mostrou um impacto estatisticamente significativo
                        no lucro (controlando pelos outros fatores). A estrat√©gia de lucro
                        parece ser independente da geografia ou da renda do cliente nesta an√°lise.
                    </p>
                </div>

            </div>
        </section>

        <!-- Sum√°rio Final -->
        <section class="border-t-2 border-gray-200 pt-8 mt-12">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Sum√°rio de Qualidade da An√°lise</h2>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                <h4 class="font-semibold text-lg text-gray-800 mb-3">üìä QUALIDADE DOS DADOS (SOBRE A AMOSTRA DE 20000 LINHAS):</h4>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li>Amostra original: <strong>20,000</strong> registros</li>
                    <li>Outliers removidos: <strong>1,436</strong> registros (7.2%)</li>
                    <li>Dataset analisado: <strong>18,564</strong> registros</li>
                    <li>Crit√©rio de remo√ß√£o: Custo acima de Q3 + 1.5 * IQR (M√©todo estat√≠stico)</li>
                </ul>
                
                <h4 class="font-semibold text-lg text-gray-800 mt-6 mb-3">üìã LIMITA√á√ïES DO MODELO:</h4>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li>R¬≤ Ajustado de <strong>61.6%</strong> indica poder explicativo <strong>moderado</strong>.</li>
                    <li>38.4% da varia√ß√£o no lucro N√ÉO √© explicada pelas vari√°veis inclu√≠das.</li>
                    <li>Multicolinearidade <strong>detectada</strong> (Cond. No.: 1,638).</li>
                </ul>
            </div>
        </section>

    </div>

</body>
</html>